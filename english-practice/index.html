<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Language Practice V9</title>

<style>
body{
  background:#0b0f1a;color:#fff;font-family:Arial;margin:0;padding:0;
}
.container{
  width:90%;
  max-width:900px;
  margin:300px auto;
  padding:20px;background:#141827;
  border-radius:10px;border:1px solid #333;
}
textarea{
  width:100%;height:130px;background:#0d1020;color:#fff;
  border:1px solid #333;border-radius:6px;padding:10px;resize:vertical;
  font-size:15px;
}
button{
  background:#d4af37;color:#111;font-weight:bold;padding:8px 16px;margin-top:10px;
  border:none;border-radius:6px;font-size:15px;cursor:pointer;
}
button:hover{background:#ffdd70;}
.btn2{background:#39405c;color:#fff;}
.btn2:hover{background:#505a85;}
#trainer{
  display:none;margin-top:20px;background:#181c2e;padding:15px;border-radius:10px;
}
.header-row{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:4px;font-size:13px;gap:6px;
}
.header-row-left,
.header-row-right{
  display:flex;align-items:center;gap:6px;flex-wrap:wrap;
}
.lang-box{
  background:#101324;border:1px solid #333;border-radius:6px;
  padding:10px;min-height:50px;font-size:16px;
}
.feedback{margin-top:6px;font-size:17px;font-weight:bold;}
.ok{color:#7cf59a;}
.err{color:#ff8d8d;}
img.borbo{
  position:fixed;left:10px;top:10px;width:160px;height:160px;
  border-radius:50%;object-fit:cover;pointer-events:none;opacity:0.95;
}
@media (max-width:700px){
  .lang-grid{flex-direction:column;}
}

/* BOX DE MODELO PARA CHATGPT */
.model-box{
  margin-top:12px;
  background:#101324;
  border:1px dashed #444;
  border-radius:8px;
  padding:10px;
  font-size:13px;
}
.model-box-title{
  font-weight:bold;
  margin-bottom:6px;
  font-size:13px;
}
.model-box small{
  color:#9ca3af;
}
.model-box textarea{
  width:100%;
  height:100px;
  background:#050814;
  color:#fff;
  border-radius:6px;
  border:1px solid #333;
  padding:8px;
  resize:vertical;
  font-size:12px;
}
.model-buttons{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:6px;
}
.model-buttons button{
  padding:6px 10px;
  font-size:12px;
  margin-top:0;
}

/* SUBSCRIBE POPUP E SININHO (igual NEWS) */
.btcbrave-login-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.75);
  display:none;align-items:center;justify-content:center;z-index:9999;
}
.btcbrave-login-card{
  background:#ffffff;color:#111827;width:100%;max-width:420px;border-radius:8px;
  padding:28px 30px 24px;box-shadow:0 25px 60px rgba(0,0,0,0.5);position:relative;
}
.btcbrave-login-close{
  position:absolute;top:10px;right:12px;border:none;background:none;font-size:18px;cursor:pointer;
}
.btcbrave-login-title{
  margin:0 0 8px;font-size:20px;font-weight:700;text-align:center;
}
.btcbrave-login-subtitle{
  margin:0 0 18px;font-size:13px;text-align:center;color:#4b5563;
}
.btcbrave-login-footnote{text-align:center;color:#6b7280;font-size:11px;margin-top:8px;}
#floating-subscribe{
  position:absolute;right:25px;top:25px;width:30px;height:30px;background:#fff;
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-size:15px;cursor:pointer;color:#000;z-index:10000;box-shadow:0 5px 15px rgba(0,0,0,0.6);
}
.select-mini{
  padding:2px 6px;
  border-radius:4px;
  border:1px solid #333;
  background:#0d1020;
  color:#fff;
  font-size:11px;
}
</style>
</head>
<body>

<!-- üîî SININHO + POPUP -->
<iframe name="hiddenBrevoFrame" style="display:none;"></iframe>

<div id="btcbraveLoginOverlay" class="btcbrave-login-overlay">
  <div class="btcbrave-login-card">
    <button id="btcbraveLoginClose" class="btcbrave-login-close">√ó</button>

    <h2 class="btcbrave-login-title">Join Language Updates</h2>
    <p class="btcbrave-login-subtitle">Get practice phrases in your email.</p>

    <form id="btcbraveLoginForm"
      action="https://2c3bfeb6.sibforms.com/serve/MUIFAKgSltnznFnj2zjaw4q0uanLuPr2YkDp8mCKOGx7h6wryGbcOg1E9mFahRvBm-kOBCKJOtMy9KAr8gMRb5wpQ6inGj09IQ58wRykX6PTnBjKQa7BQbWUIMTEIc54CEooAtFJHCiYZsoGRvag8I6YxWeVxSqiv_dCO4fEwcbslj8RbwoeIRN9V_5L3R8BiSU8D_unfJRG8BsjcA=="
      method="POST" target="hiddenBrevoFrame">

      <input type="email" id="btcbraveLoginEmail" name="EMAIL"
        placeholder="Enter your email" required
        style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;font-size:14px;">

      <button type="submit"
        style="width:100%;margin-top:10px;padding:10px;border-radius:999px;border:none;
        background:linear-gradient(90deg,#3b82f6,#8b5cf6,#ec4899,#f97316);
        color:#fff;font-size:14px;font-weight:700;cursor:pointer;">
        Continue
      </button>
    </form>

    <p class="btcbrave-login-footnote">No spam ‚Äî unsubscribe anytime.</p>
  </div>
</div>

<div id="floating-subscribe">üîî</div>
<!-- üî• FIM subscribe -->

<img src="/imgs/borboleta.png" class="borbo">

<div class="container">

<h2>Language Practice</h2>
<p>Write phrases like: <b>Language 1 | your language 2</b></p>

<textarea id="lista" placeholder="Example:
Io amo il caff√® | I love coffee
Je vis √† Londres | I live in London"></textarea>

<!-- üìå BOX DE MODELO PARA CHATGPT -->
<div class="model-box">
  <div class="model-box-title">Prompt model for ChatGPT</div>
  <small>Copy, paste into ChatGPT and replace the text after <b>TEXT:</b></small>

  <p style="margin:6px 0 4px;">Language 1 ‚Üí Language 2</p>
  <textarea id="promptL2L1" readonly>
Take the text below, split it into short sentences, translate each part, and return everything in the format:

 Language 1 | Language 2

Ready for me to paste into my training app.

TEXT:
  </textarea>

  <div class="model-buttons">
    <button type="button" onclick="copyPrompt('promptL2L1')">Copy Language 1 ‚Üí 2</button>
  </div>
</div>

<button onclick="startTraining()">Load & Start</button>

<div id="trainer">
  <p id="status" style="margin-bottom:12px;"></p>

  <div class="lang-grid" style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px;">

    <!-- LADO IDIOMA 1 -->
    <div style="flex:1;min-width:200px;">
      <div class="header-row">
        <div class="header-row-left">
          <span><b>Language 1</b></span>
          <select id="voiceLangLeft" class="select-mini" onchange="onChangeLangLeft(this.value)">
            <option value="en-GB" selected>English (UK)</option>
            <option value="en-US">English (US)</option>
            <option value="pt-BR">Portugu√™s (BR)</option>
            <option value="it-IT">Italiano</option>
            <option value="es-ES">Espa√±ol</option>
            <option value="fr-FR">Fran√ßais</option>
            <option value="de-DE">Deutsch</option>
            <option value="ro-RO">Rom√¢nƒÉ</option>
            <option value="hi-IN">Hindi</option>
            <option value="ar-SA">Arabic</option>
            <option value="ja-JP">Japanese</option>
          </select>
        </div>
        <button class="btn2" id="btnEN" onclick="toggleEN()">Hide L1</button>
      </div>
      <div id="enBox" class="lang-box"></div>
    </div>

    <!-- LADO IDIOMA 2 -->
    <div style="flex:1;min-width:200px;">
      <div class="header-row">
        <div class="header-row-right">
          <span><b>Language 2</b></span>
          <select id="voiceLang" class="select-mini" onchange="onChangeLangRight(this.value)">
            <option value="it-IT">Italiano</option>
            <option value="pt-BR" selected>Portugu√™s (BR)</option>
            <option value="es-ES">Espa√±ol</option>
            <option value="fr-FR">Fran√ßais</option>
            <option value="de-DE">Deutsch</option>
            <option value="ro-RO">Rom√¢nƒÉ</option>
            <option value="hi-IN">Hindi</option>
            <option value="ar-SA">Arabic</option>
            <option value="ja-JP">Japanese</option>
            <option value="en-GB">English (UK)</option>
            <option value="en-US">English (US)</option>
          </select>
        </div>
        <button class="btn2" id="btnPT" onclick="togglePT()">Hide L2</button>
      </div>
      <div id="ptBox" class="lang-box"></div>
    </div>

  </div>

  <textarea id="answer" placeholder="Type the Language 2 sentence and press ENTER..."></textarea>

  <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap;">
    <button class="btn2" onclick="goBack()">Back</button>
    <button class="btn2" onclick="skip()">Skip</button>
    <button class="btn2" onclick="showAnswer()">Show Answer</button>
    <button class="btn2" onclick="playEN()">üîä Language 1</button>
    <button class="btn2" onclick="playOther()">üîä Language 2</button>
    <!-- BOT√ÉO DE MODO: DIGITAR L1 OU L2 -->
    <button class="btn2" id="modeBtn" onclick="toggleTargetSide()">‚úèÔ∏è Type L2 (Language 2)</button>
  </div>

  <div style="margin-top:10px;display:flex;gap:15px;flex-wrap:wrap;">
    <div>
      Speed L1:<br>
      <input type="range" id="rateEN" min="0.6" max="1.4" step="0.05" value="0.95" oninput="updateRateEN(this.value)">
      <span id="rateENVal">0.95x</span>
    </div>
    <div>
      Speed L2:<br>
      <input type="range" id="rateOther" min="0.6" max="1.4" step="0.05" value="1.0" oninput="updateRateOther(this.value)">
      <span id="rateOtherVal">1.0x</span>
    </div>
  </div>

  <p id="feedback"></p>
  <p id="finished" style="display:none;font-size:22px;color:#8affc6;margin-top:15px;">üéâ Finished!</p>

</div>
</div>

<!-- üîÅ SCRIPT DO TREINO ‚Äì MEM√ìRIA + DOIS LADOS -->
<script>
/* --- SCRIPT DO TREINO COM MEM√ìRIA DE CONFIGURA√á√ïES --- */
const STORAGE_KEY   = 'englishPractice_phrases_v9';
const SETTINGS_KEY  = 'englishPractice_settings_v2';
const PROGRESS_KEY  = 'englishPractice_progress_v1';
const TARGETSIDE_KEY= 'englishPractice_targetSide_v1';

let phrases = [];
let index = 0;
let ptHidden = false;
let enHidden = false;

let speechRateEN     = 0.95;  // Language 1
let speechRateOther  = 1.0;   // Language 2

let leftLang  = 'en-GB'; // padr√£o L1
let rightLang = 'pt-BR'; // padr√£o L2

// alvo da resposta: 'right' = Language 2 (padr√£o), 'left' = Language 1
let targetSide = 'left';

function saveSettings(){
  const data = {
    leftLang:   leftLang,
    rightLang:  rightLang,
    rateEN:     speechRateEN,
    rateOther:  speechRateOther
  };
  try{
    localStorage.setItem(SETTINGS_KEY, JSON.stringify(data));
  }catch(e){}
}

function hashText(str){
  // hash simples e est√°vel (pra saber se a lista mudou)
  let h = 2166136261;
  for (let i = 0; i < str.length; i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return (h >>> 0).toString(16);
}

function saveProgress(rawText){
  try{
    const payload = {
      hash: hashText(rawText || ''),
      index: index,
      ts: Date.now()
    };
    localStorage.setItem(PROGRESS_KEY, JSON.stringify(payload));
  }catch(e){}
}

function loadProgress(rawText){
  try{
    const saved = localStorage.getItem(PROGRESS_KEY);
    if (!saved) return 0;
    const obj = JSON.parse(saved);
    if (!obj || typeof obj.index !== 'number' || !obj.hash) return 0;

    const currentHash = hashText(rawText || '');
    if (obj.hash !== currentHash) return 0;

    if (obj.index < 0) return 0;
    return obj.index;
  }catch(e){
    return 0;
  }
}

function onChangeLangLeft(code){
  leftLang = code;
  const sel = document.getElementById('voiceLangLeft');
  if (sel) sel.value = code;
  saveSettings();
}

function onChangeLangRight(code){
  rightLang = code;
  const sel = document.getElementById('voiceLang');
  if (sel) sel.value = code;
  saveSettings();
}

function speak(text, lang, rate){
  const utter = new SpeechSynthesisUtterance(text);
  const voices = speechSynthesis.getVoices();
  const v = voices.find(a => a.lang === lang) ||
            voices.find(a => a.lang && a.lang.startsWith(lang.split('-')[0]));
  if (v){
    utter.voice = v;
    utter.lang  = v.lang;
  } else {
    utter.lang = lang;
  }
  utter.rate = rate;
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

function playEN(){
  if (index < phrases.length){
    speak(phrases[index].left, leftLang, speechRateEN);
  }
}

function playOther(){
  if (index < phrases.length){
    speak(phrases[index].right, rightLang, speechRateOther);
  }
}

function updateRateEN(val){
  speechRateEN = parseFloat(val);
  const span = document.getElementById('rateENVal');
  if (span) span.textContent = val + 'x';
  saveSettings();
}

function updateRateOther(val){
  speechRateOther = parseFloat(val);
  const span = document.getElementById('rateOtherVal');
  if (span) span.textContent = val + 'x';
  saveSettings();
}

// carrega vozes
speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();

window.addEventListener('DOMContentLoaded', () => {
  const lista = document.getElementById('lista');
  const selL  = document.getElementById('voiceLangLeft');
  const selR  = document.getElementById('voiceLang');
  const rateENInput      = document.getElementById('rateEN');
  const rateOtherInput   = document.getElementById('rateOther');
  const rateENValSpan    = document.getElementById('rateENVal');
  const rateOtherValSpan = document.getElementById('rateOtherVal');

  // Frases salvas
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved && lista){
    lista.value = saved;
  }
  if (lista){
    lista.addEventListener('input', () => {
      localStorage.setItem(STORAGE_KEY, lista.value);
    });
  }

  // Modo salvo (Type L1/L2)
  try{
    const savedSide = localStorage.getItem(TARGETSIDE_KEY);
    if (savedSide === 'left' || savedSide === 'right'){
      targetSide = savedSide;
    }
  }catch(e){}

  // Configura√ß√µes salvas
  try{
    const raw = localStorage.getItem(SETTINGS_KEY);
    if (raw){
      const cfg = JSON.parse(raw);

      if (cfg.leftLang && selL){
        leftLang = cfg.leftLang;
        selL.value = leftLang;
      }
      if (cfg.rightLang && selR){
        rightLang = cfg.rightLang;
        selR.value = rightLang;
      }

      if (typeof cfg.rateEN === 'number' && rateENInput){
        speechRateEN = cfg.rateEN;
        rateENInput.value = cfg.rateEN;
        if (rateENValSpan) rateENValSpan.textContent = cfg.rateEN + 'x';
      }

      if (typeof cfg.rateOther === 'number' && rateOtherInput){
        speechRateOther = cfg.rateOther;
        rateOtherInput.value = cfg.rateOther;
        if (rateOtherValSpan) rateOtherValSpan.textContent = cfg.rateOther + 'x';
      }
    }
  }catch(e){}

  updateTargetSideUI();
});

// Inicia treino
function startTraining(){
  const lista = document.getElementById("lista");
  if (!lista) return;

  const raw = lista.value.trim();
  if (!raw){
    alert("Write phrases like:\nLanguage 1 | Your Language 2");
    return;
  }

  const rawLines = raw.split("\n");
  phrases = [];

  rawLines.forEach(line => {
    const p = line.split("|");
    if (p.length === 2){
      phrases.push({ left: p[0].trim(), right: p[1].trim() });
    }
  });

  if (!phrases.length){
    alert("Use: Language 1 text | Language 2 text");
    return;
  }

  localStorage.setItem(STORAGE_KEY, lista.value);

  // ‚úÖ restaura onde parou (se a lista for a mesma)
  const savedIndex = loadProgress(raw);
  index = (savedIndex >= 0 && savedIndex < phrases.length) ? savedIndex : 0;

  document.getElementById("trainer").style.display = "block";
  document.getElementById("finished").style.display = "none";
  document.getElementById("answer").disabled = false;

  showCurrent();
  updateTargetSideUI();
}

function showCurrent(){
  const status   = document.getElementById("status");
  const feedback = document.getElementById("feedback");
  const leftBox  = document.getElementById("enBox");
  const rightBox = document.getElementById("ptBox");
  const answer   = document.getElementById("answer");
  const finished = document.getElementById("finished");

  feedback.textContent = "";
  finished.style.display = "none";

  if (index >= phrases.length){
    status.textContent = "‚úî Completed";
    leftBox.textContent  = "-";
    rightBox.textContent = "-";
    answer.value       = "";
    answer.disabled    = true;
    finished.style.display = "block";
    return;
  }

  status.textContent = `Phrase ${index + 1} / ${phrases.length}`;
  leftBox.textContent  = phrases[index].left;
  rightBox.textContent = phrases[index].right;

  answer.value = "";
  answer.focus();

  // ‚úÖ salva posi√ß√£o sempre que mostrar a frase
  const lista = document.getElementById("lista");
  if (lista) saveProgress(lista.value.trim());
}

document.addEventListener("keydown", e => {
  if (e.key === "Enter" && document.activeElement.id === "answer"){
    e.preventDefault();
    checkAnswer();
  }
});

/* ‚úÖ FIX: normaliza√ß√£o para reconhecer ' e ‚Äô como iguais + espa√ßos/pontua√ß√£o final */
function normalizeForCompare(str){
  return (str || "")
    .normalize("NFKC")
    .toLowerCase()
    .trim()
    .replace(/[‚Äô‚Äò¬¥`]/g, "'")
    .replace(/[‚Äú‚Äù]/g, '"')
    .replace(/\s+/g, " ")
    .replace(/^[‚Äú"']+|[‚Äù"']+$/g, "")
    .replace(/[.!?‚Ä¶]+$/g, "");
}

function checkAnswer(){
  const answerEl = document.getElementById("answer");
  const feedback = document.getElementById("feedback");
  if (!answerEl) return;

  const userRaw = answerEl.value;
  if (!userRaw.trim()) return;

  const correctBase = (targetSide === 'right')
    ? (phrases[index].right || "")
    : (phrases[index].left  || "");

  const user = normalizeForCompare(userRaw);
  const correct = normalizeForCompare(correctBase);

  if (user === correct){
    feedback.innerHTML = "<span class='ok'>‚úî correct</span>";
    setTimeout(() => {
      index++;
      showCurrent();
    }, 600);
  } else {
    feedback.innerHTML = `<span class='err'>‚úò wrong ‚Äî correct: "${correctBase}"</span>`;
  }
}

function skip(){
  index++;
  showCurrent();
}

function goBack(){
  if (index > 0){
    index--;
    showCurrent();
  }
}

function showAnswer(){
  const feedback = document.getElementById("feedback");
  if (!feedback) return;

  const correctBase = (targetSide === 'right')
    ? (phrases[index].right || "")
    : (phrases[index].left  || "");

  feedback.innerHTML = `<span class='ok'>üí° correct answer: "${correctBase}"</span>`;
}

function togglePT(){
  const box = document.getElementById("ptBox");
  const btn = document.getElementById("btnPT");
  ptHidden  = !ptHidden;
  box.style.visibility = ptHidden ? "hidden" : "visible";
  btn.textContent      = ptHidden ? "Show L2" : "Hide L2";
}

function toggleEN(){
  const box = document.getElementById("enBox");
  const btn = document.getElementById("btnEN");
  enHidden  = !enHidden;
  box.style.visibility = enHidden ? "hidden" : "visible";
  btn.textContent      = enHidden ? "Show L1" : "Hide L1";
}

/* üîÅ TROCAR MODO: DIGITAR L1 OU L2 */
function toggleTargetSide(){
  targetSide = (targetSide === 'right') ? 'left' : 'right';
  try{ localStorage.setItem(TARGETSIDE_KEY, targetSide); }catch(e){}
  updateTargetSideUI();
}

function updateTargetSideUI(){
  const btn = document.getElementById('modeBtn');
  const answer = document.getElementById('answer');
  if (!btn || !answer) return;

  if (targetSide === 'right'){
    btn.textContent = '‚úèÔ∏è Type L2 (Language 2)';
    answer.placeholder = 'Type the Language 2 sentence and press ENTER...';
  } else {
    btn.textContent = '‚úèÔ∏è Type L1 (Language 1)';
    answer.placeholder = 'Type the Language 1 sentence and press ENTER...';
  }
}

/* COPIAR PROMPTS */
function copyPrompt(id){
  const el = document.getElementById(id);
  if(!el) return;
  const text = el.value;

  if (navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).then(()=>{
      alert("Prompt copied!");
    }).catch(()=>{
      fallbackCopy(el);
    });
  } else {
    fallbackCopy(el);
  }
}

function fallbackCopy(el){
  el.select();
  el.setSelectionRange(0, 99999);
  document.execCommand("copy");
  alert("Prompt copied!");
}
</script>

<!-- üî• SCRIPT SUBSCRIBE IGUAL NEWS COM UNSUBSCRIBE -->
<script>
document.addEventListener('DOMContentLoaded',function(){

  let overlay=document.getElementById('btcbraveLoginOverlay'),
      btn=document.getElementById('floating-subscribe'),
      close=document.getElementById('btcbraveLoginClose'),
      form=document.getElementById('btcbraveLoginForm'),
      email=document.getElementById('btcbraveLoginEmail');

  function open(){overlay.style.display='flex'}
  function closeNow(){overlay.style.display='none'}

  // ====== CONTROLE DE ESTADO DO SININHO ======
  function updateBell(){
    if(localStorage.getItem('englishSubscribed')){
      btn.innerHTML="üîî";
      btn.style.background="#00c853";
    } else {
      btn.innerHTML="üîî";
      btn.style.background="#fff";
    }
  }
  updateBell();

  // ====== AUTO-POPUP NA PRIMEIRA VEZ ======
  if(!localStorage.getItem('englishSubscribed')){
    setTimeout(open,1500);
  }

  // ====== CLIQUE NO SININHO ======
  btn.onclick=function(){
    if(localStorage.getItem('englishSubscribed')){
      if(confirm("You are subscribed.\nDo you want to unsubscribe?")){
        localStorage.removeItem('englishSubscribed');
        updateBell();
        alert("Unsubscribed successfully.");
      }
      return;
    }
    open();
  };

  // ====== FECHAR POPUP ======
  close.onclick=closeNow;
  overlay.onclick=e=>{if(e.target===overlay)closeNow();}

  // ====== FORM SUBMIT ======
  form.onsubmit=function(){
    localStorage.setItem('englishSubscribed','true');
    setTimeout(()=>{
      alert("Subscribed successfully!");
      closeNow();
      updateBell();
    },700);
  }

});
</script>

</body>
</html>
