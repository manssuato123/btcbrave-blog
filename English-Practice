<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>English Practice V9</title>

<style>
body{
  background:#0b0f1a;color:#fff;font-family:Arial;margin:0;padding:0;
}
.container{
  width:90%;
  max-width:900px;
  margin:300px auto;
  padding:20px;background:#141827;
  border-radius:10px;border:1px solid #333;
}
textarea{
  width:100%;height:130px;background:#0d1020;color:#fff;
  border:1px solid #333;border-radius:6px;padding:10px;resize:vertical;
  font-size:15px;
}
button{
  background:#d4af37;color:#111;font-weight:bold;padding:8px 16px;margin-top:10px;
  border:none;border-radius:6px;font-size:15px;cursor:pointer;
}
button:hover{background:#ffdd70;}
.btn2{background:#39405c;color:#fff;}
.btn2:hover{background:#505a85;}
#trainer{
  display:none;margin-top:20px;background:#181c2e;padding:15px;border-radius:10px;
}
.header-row{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:4px;font-size:13px;
}
.lang-box{
  background:#101324;border:1px solid #333;border-radius:6px;
  padding:10px;min-height:50px;font-size:16px;
}
.feedback{margin-top:6px;font-size:17px;font-weight:bold;}
.ok{color:#7cf59a;}
.err{color:#ff8d8d;}
img.borbo{
  position:fixed;left:10px;top:10px;width:160px;height:160px;
  border-radius:50%;object-fit:cover;pointer-events:none;opacity:0.95;
}
@media (max-width:700px){
  .lang-grid{flex-direction:column;}
}

/* SUBSCRIBE POPUP E SININHO (igual NEWS) */
.btcbrave-login-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.75);
  display:none;align-items:center;justify-content:center;z-index:9999;
}
.btcbrave-login-card{
  background:#ffffff;color:#111827;width:100%;max-width:420px;border-radius:8px;
  padding:28px 30px 24px;box-shadow:0 25px 60px rgba(0,0,0,0.5);position:relative;
}
.btcbrave-login-close{
  position:absolute;top:10px;right:12px;border:none;background:none;font-size:18px;cursor:pointer;
}
.btcbrave-login-title{
  margin:0 0 8px;font-size:20px;font-weight:700;text-align:center;
}
.btcbrave-login-subtitle{
  margin:0 0 18px;font-size:13px;text-align:center;color:#4b5563;
}
.btcbrave-login-footnote{text-align:center;color:#6b7280;font-size:11px;margin-top:8px;}
#floating-subscribe{
  position:absolute;right:25px;top:25px;width:30px;height:30px;background:#fff;
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-size:15px;cursor:pointer;color:#000;z-index:10000;box-shadow:0 5px 15px rgba(0,0,0,0.6);
}
</style>
</head>
<body>

<!-- ðŸ”” SININHO + POPUP -->
<iframe name="hiddenBrevoFrame" style="display:none;"></iframe>

<div id="btcbraveLoginOverlay" class="btcbrave-login-overlay">
  <div class="btcbrave-login-card">
    <button id="btcbraveLoginClose" class="btcbrave-login-close">Ã—</button>

    <h2 class="btcbrave-login-title">Join English Updates</h2>
    <p class="btcbrave-login-subtitle">Get English practice in your email.</p>

    <form id="btcbraveLoginForm"
      action="https://2c3bfeb6.sibforms.com/serve/MUIFAKgSltnznFnj2zjaw4q0uanLuPr2YkDp8mCKOGx7h6wryGbcOg1E9mFahRvBm-kOBCKJOtMy9KAr8gMRb5wpQ6inGj09IQ58wRykX6PTnBjKQa7BQbWUIMTEIc54CEooAtFJHCiYZsoGRvag8I6YxWeVxSqiv_dCO4fEwcbslj8RbwoeIRN9V_5L3R8BiSU8D_unfJRG8BsjcA=="
      method="POST" target="hiddenBrevoFrame">

      <input type="email" id="btcbraveLoginEmail" name="EMAIL"
        placeholder="Enter your email" required
        style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;font-size:14px;">

      <button type="submit"
        style="width:100%;margin-top:10px;padding:10px;border-radius:999px;border:none;
        background:linear-gradient(90deg,#3b82f6,#8b5cf6,#ec4899,#f97316);
        color:#fff;font-size:14px;font-weight:700;cursor:pointer;">
        Continue
      </button>
    </form>

    <p class="btcbrave-login-footnote">No spam â€” unsubscribe anytime.</p>
  </div>
</div>

<div id="floating-subscribe">ðŸ””</div>
<!-- ðŸ”¥ FIM subscribe -->

<img src="imgs/borboleta.png" class="borbo">

<div class="container">

<h2>English Practice</h2>
<p>Write phrases like: <b>Other language | English</b></p>

<textarea id="lista" placeholder="Example:
Io amo il caffÃ¨ | I love coffee
Je vis Ã  Londres | I live in London"></textarea>

<button onclick="startTraining()">Load & Start</button>

<div id="trainer">
  <p id="status" style="margin-bottom:12px;"></p>

  <div class="lang-grid" style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px;">

    <div style="flex:1;min-width:200px;">
      <div class="header-row">
        <span><b>English (UK)</b></span>
        <button class="btn2" id="btnEN" onclick="toggleEN()">Hide EN</button>
      </div>
      <div id="enBox" class="lang-box"></div>
    </div>

    <div style="flex:1;min-width:200px;">
      <div class="header-row">
        <span><b>Other language</b></span>
        <button class="btn2" id="btnPT" onclick="togglePT()">Hide</button>
      </div>
      <div id="ptBox" class="lang-box"></div>
    </div>

  </div>

  <textarea id="answer" placeholder="Type the English translation and press ENTER..."></textarea>

  <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap;">
    <button class="btn2" onclick="goBack()">Back</button>
    <button class="btn2" onclick="skip()">Skip</button>
    <button class="btn2" onclick="showAnswer()">Show Answer</button>
    <button class="btn2" onclick="playEN()">ðŸ”Š English</button>
    <button class="btn2" onclick="playOther()">ðŸ”Š Other</button>
  </div>

  <div style="margin-top:12px;">
    <label>Language of OTHER:</label><br>
    <select id="voiceLang" onchange="onChangeLang(this.value)" style="padding:6px;border-radius:6px;">
      <option value="it-IT" selected>ðŸ‡®ðŸ‡¹ Italian</option>
      <option value="pt-BR">ðŸ‡§ðŸ‡· Portuguese</option>
      <option value="es-ES">ðŸ‡ªðŸ‡¸ Spanish</option>
      <option value="fr-FR">ðŸ‡«ðŸ‡· French</option>
      <option value="de-DE">ðŸ‡©ðŸ‡ª German</option>
      <option value="ro-RO">ðŸ‡·ðŸ‡´ Romanian</option>
      <option value="hi-IN">ðŸ‡®ðŸ‡³ Hindi</option>
      <option value="ar-SA">ðŸ‡¸ðŸ‡¦ Arabic</option>
      <option value="ja-JP">ðŸ‡¯ðŸ‡µ Japanese</option>
    </select>
  </div>

  <div style="margin-top:10px;display:flex;gap:15px;">
    <div>
      Speed EN:<br>
      <input type="range" id="rateEN" min="0.6" max="1.4" step="0.05" value="0.95" oninput="updateRateEN(this.value)">
      <span id="rateENVal">0.95x</span>
    </div>
    <div>
      Speed Other:<br>
      <input type="range" id="rateOther" min="0.6" max="1.4" step="0.05" value="1.0" oninput="updateRateOther(this.value)">
      <span id="rateOtherVal">1.0x</span>
    </div>
  </div>

  <p id="feedback"></p>
  <p id="finished" style="display:none;font-size:22px;color:#8affc6;margin-top:15px;">ðŸŽ‰ Finished!</p>

</div>
</div>

<!-- ðŸ” SCRIPT DO TREINO â€“ COM IDIOMA + VELOCIDADE SALVOS -->
<script>
/* --- SCRIPT DO TREINO COM MEMÃ“RIA DE CONFIGURAÃ‡Ã•ES --- */
const STORAGE_KEY  = 'englishPractice_phrases_v9';
const SETTINGS_KEY = 'englishPractice_settings_v1';

let phrases = [];
let index = 0;
let ptHidden = false;
let enHidden = false;

let speechRateEN     = 0.95;
let speechRateOther  = 1.0;
let selectedLang     = 'it-IT'; // padrÃ£o

function saveSettings(){
  const data = {
    lang:      selectedLang,
    rateEN:    speechRateEN,
    rateOther: speechRateOther
  };
  try{
    localStorage.setItem(SETTINGS_KEY, JSON.stringify(data));
  }catch(e){}
}

function onChangeLang(code){
  selectedLang = code;
  const sel = document.getElementById('voiceLang');
  if (sel) sel.value = code;
  saveSettings();
}

function setLang(code){
  // pode usar em botÃµes tipo Italian / Portuguese
  selectedLang = code;
  const sel = document.getElementById('voiceLang');
  if (sel) sel.value = code;
  saveSettings();
}

function speak(text, lang, rate){
  const utter = new SpeechSynthesisUtterance(text);
  const voices = speechSynthesis.getVoices();
  const v = voices.find(a => a.lang === lang) ||
            voices.find(a => a.lang && a.lang.startsWith(lang.split('-')[0]));
  if (v){
    utter.voice = v;
    utter.lang  = v.lang;
  } else {
    utter.lang = lang;
  }
  utter.rate = rate;
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

function playEN(){
  if (index < phrases.length){
    speak(phrases[index].en, 'en-GB', speechRateEN);
  }
}

function playOther(){
  if (index < phrases.length){
    speak(phrases[index].pt, selectedLang, speechRateOther);
  }
}

function updateRateEN(val){
  speechRateEN = parseFloat(val);
  const span = document.getElementById('rateENVal');
  if (span) span.textContent = val + 'x';
  saveSettings();
}

function updateRateOther(val){
  speechRateOther = parseFloat(val);
  const span = document.getElementById('rateOtherVal');
  if (span) span.textContent = val + 'x';
  saveSettings();
}

// carrega vozes
speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();

window.addEventListener('DOMContentLoaded', () => {
  const lista = document.getElementById('lista');
  const sel   = document.getElementById('voiceLang');
  const rateENInput    = document.getElementById('rateEN');
  const rateOtherInput = document.getElementById('rateOther');
  const rateENValSpan  = document.getElementById('rateENVal');
  const rateOtherValSpan = document.getElementById('rateOtherVal');

  // Frases salvas
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved && lista){
    lista.value = saved;
  }
  if (lista){
    lista.addEventListener('input', () => {
      localStorage.setItem(STORAGE_KEY, lista.value);
    });
  }

  // ConfiguraÃ§Ãµes salvas (idioma + velocidades)
  try{
    const raw = localStorage.getItem(SETTINGS_KEY);
    if (raw){
      const cfg = JSON.parse(raw);

      if (cfg.lang){
        selectedLang = cfg.lang;
        if (sel) sel.value = cfg.lang;
      } else if (sel){
        // se nÃ£o tinha salvo, mantÃ©m padrÃ£o
        selectedLang = sel.value;
      }

      if (typeof cfg.rateEN === 'number' && rateENInput){
        speechRateEN = cfg.rateEN;
        rateENInput.value = cfg.rateEN;
        if (rateENValSpan) rateENValSpan.textContent = cfg.rateEN + 'x';
      }

      if (typeof cfg.rateOther === 'number' && rateOtherInput){
        speechRateOther = cfg.rateOther;
        rateOtherInput.value = cfg.rateOther;
        if (rateOtherValSpan) rateOtherValSpan.textContent = cfg.rateOther + 'x';
      }
    } else {
      // primeira vez: sincroniza selectedLang com select
      if (sel){
        selectedLang = sel.value;
      }
    }
  }catch(e){
    if (sel) selectedLang = sel.value;
  }
});

// Inicia treino
function startTraining(){
  const lista = document.getElementById("lista");
  if (!lista) return;

  const rawLines = lista.value.trim().split("\n");
  phrases = [];

  rawLines.forEach(line => {
    const p = line.split("|");
    if (p.length === 2){
      phrases.push({ pt: p[0].trim(), en: p[1].trim() });
    }
  });

  if (!phrases.length){
    alert("Use: Other language | English");
    return;
  }

  localStorage.setItem(STORAGE_KEY, lista.value);

  index = 0;
  document.getElementById("trainer").style.display = "block";
  document.getElementById("finished").style.display = "none";
  document.getElementById("answer").disabled = false;

  showCurrent();
}

function showCurrent(){
  const status   = document.getElementById("status");
  const feedback = document.getElementById("feedback");
  const ptBox    = document.getElementById("ptBox");
  const enBox    = document.getElementById("enBox");
  const answer   = document.getElementById("answer");
  const finished = document.getElementById("finished");

  feedback.textContent = "";
  finished.style.display = "none";

  if (index >= phrases.length){
    status.textContent = "âœ” Completed";
    enBox.textContent  = "-";
    ptBox.textContent  = "-";
    answer.value       = "";
    answer.disabled    = true;
    finished.style.display = "block";
    return;
  }

  status.textContent = `Phrase ${index + 1} / ${phrases.length}`;
  enBox.textContent  = phrases[index].en;
  ptBox.textContent  = phrases[index].pt;

  answer.value = "";
  answer.focus();
}

document.addEventListener("keydown", e => {
  if (e.key === "Enter" && document.activeElement.id === "answer"){
    e.preventDefault();
    checkAnswer();
  }
});

function checkAnswer(){
  const answerEl = document.getElementById("answer");
  const feedback = document.getElementById("feedback");
  if (!answerEl) return;

  const user = answerEl.value.trim().toLowerCase();
  const correct = (phrases[index].en || "").trim().toLowerCase();

  if (!user) return;

  if (user === correct){
    feedback.innerHTML = "<span class='ok'>âœ” correct</span>";
    setTimeout(() => { index++; showCurrent(); }, 600);
  } else {
    feedback.innerHTML = `<span class='err'>âœ˜ wrong â€” correct: "${phrases[index].en}"</span>`;
  }
}

function skip(){
  index++;
  showCurrent();
}

function goBack(){
  if (index > 0){
    index--;
    showCurrent();
  }
}

function showAnswer(){
  const feedback = document.getElementById("feedback");
  if (!feedback) return;
  feedback.innerHTML = `<span class='ok'>ðŸ’¡ correct answer: "${phrases[index].en}"</span>`;
}

function togglePT(){
  const box = document.getElementById("ptBox");
  const btn = document.getElementById("btnPT");
  ptHidden  = !ptHidden;
  box.style.visibility = ptHidden ? "hidden" : "visible";
  btn.textContent      = ptHidden ? "Show" : "Hide";
}

function toggleEN(){
  const box = document.getElementById("enBox");
  const btn = document.getElementById("btnEN");
  enHidden  = !enHidden;
  box.style.visibility = enHidden ? "hidden" : "visible";
  btn.textContent      = enHidden ? "Show EN" : "Hide EN";
}
</script>

<!-- ðŸ”¥ SCRIPT SUBSCRIBE IGUAL NEWS COM UNSUBSCRIBE -->
<script>
document.addEventListener('DOMContentLoaded',function(){

  let overlay=document.getElementById('btcbraveLoginOverlay'),
      btn=document.getElementById('floating-subscribe'),
      close=document.getElementById('btcbraveLoginClose'),
      form=document.getElementById('btcbraveLoginForm'),
      email=document.getElementById('btcbraveLoginEmail');

  function open(){overlay.style.display='flex'}
  function closeNow(){overlay.style.display='none'}

  // ====== CONTROLE DE ESTADO DO SININHO ======
  function updateBell(){
    if(localStorage.getItem('englishSubscribed')){
      btn.innerHTML="ðŸ”•";
      btn.style.background="#00c853";  // verde quando inscrito
    } else {
      btn.innerHTML="ðŸ””";
      btn.style.background="#fff";
    }
  }
  updateBell();

  // ====== AUTO-POPUP NA PRIMEIRA VEZ ======
  if(!localStorage.getItem('englishSubscribed')){
    setTimeout(open,1500);
  }

  // ====== CLIQUE NO SININHO ======
  btn.onclick=function(){
    if(localStorage.getItem('englishSubscribed')){
      if(confirm("You are subscribed.\nDo you want to unsubscribe?")){
        localStorage.removeItem('englishSubscribed');
        updateBell();
        alert("Unsubscribed successfully.");
      }
      return;
    }
    open();
  };

  // ====== FECHAR POPUP ======
  close.onclick=closeNow;
  overlay.onclick=e=>{if(e.target===overlay)closeNow();}

  // ====== FORM SUBMIT ======
  form.onsubmit=function(){
    localStorage.setItem('englishSubscribed','true');
    setTimeout(()=>{
      alert("Subscribed successfully!");
      closeNow();
      updateBell();
    },700);
  }

});
</script>

</body>
</html>
